(()=>{const e=document.createElement("div");Object.assign(e.style,{zIndex:"999999",position:"fixed",top:"50px",right:"50px",width:"400px",backgroundColor:"rgb(12 12 12)",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)",padding:"16px",color:"white"});const t=document.createElement("h3");t.textContent="TrollCam",t.style.marginTop="0",t.style.marginBottom="12px",e.appendChild(t);const n=document.createElement("div");Object.assign(n.style,{width:"100%",aspectRatio:"16 / 9",border:"1px solid #ccc",borderRadius:"6px",overflow:"hidden",background:"#000",marginBottom:"12px"});const o=document.createElement("video");Object.assign(o,{controls:!0,loop:!0}),Object.assign(o.style,{width:"100%",height:"100%",backgroundColor:"#000"}),n.appendChild(o),e.appendChild(n);const d=document.createElement("ul");Object.assign(d.style,{listStyle:"none",padding:"0",margin:"0 0 12px 0",maxHeight:"120px",overflowY:"auto",borderTop:"1px solid #eee",borderBottom:"1px solid #eee"}),e.appendChild(d);const i=document.createElement("button");i.textContent="Add Video",Object.assign(i.style,{width:"100%",padding:"10px",border:"none",borderRadius:"4px",backgroundColor:"#007BFF",color:"#fff",cursor:"pointer",fontSize:"14px"}),i.onmouseover=()=>i.style.backgroundColor="#0056b3",i.onmouseout=()=>i.style.backgroundColor="#007BFF",e.appendChild(i),document.body.appendChild(e);const a=document.createElement("input");a.type="file",a.accept="video/*",a.style.display="none",document.body.appendChild(a),i.addEventListener("click",(()=>a.click()));let r=[],l=null,c=new MediaStream,s=new MediaStream,u=null,p=null;const g=new AudioContext;function m(e){o.pause(),o.removeAttribute("src"),o.load(),o.src=e,o.onloadedmetadata=()=>{const e=o.captureStream();o.play();const t=e.getVideoTracks()[0];t&&(u&&c.removeTrack(u),c.addTrack(t),u=t);const n=e.getAudioTracks()[0];n&&(p&&s.removeTrack(p),s.addTrack(n),p=n,g.createMediaStreamSource(e).connect(g.destination))}}a.addEventListener("change",(()=>{const e=a.files[0];if(!e)return;const t=new FileReader;t.onload=function(t){const n=t.target.result;r.push({url:n,name:e.name});const o=document.createElement("li");o.textContent=e.name,Object.assign(o.style,{padding:"6px 10px",cursor:"pointer",borderRadius:"4px"}),o.onmouseover=()=>o.style.backgroundColor="#161616",o.onmouseout=()=>o.style.backgroundColor="transparent",o.onclick=()=>{l=r.findIndex((e=>e.url===n)),m(n)},d.appendChild(o),1===r.length&&m(n)},t.readAsDataURL(e)}));let v=Math.random().toString(36).substring(2,15),b=Math.random().toString(36).substring(2,15),x=navigator.mediaDevices.enumerateDevices;navigator.mediaDevices.enumerateDevices=async function(){let e=await x.call(navigator.mediaDevices);return e.push({kind:"videoinput",label:"TrollCam",deviceId:v,groupId:v,getCapabilities:()=>u?.getCapabilities()||{},toJSON(){return{deviceId:this.deviceId,groupId:this.groupId,kind:this.kind,label:this.label}}},{kind:"audioinput",label:"TrollMic",deviceId:b,groupId:b,getCapabilities:()=>p?.getCapabilities()||{},toJSON(){return{deviceId:this.deviceId,groupId:this.groupId,kind:this.kind,label:this.label}}}),e};let y=navigator.mediaDevices.getUserMedia;navigator.mediaDevices.getUserMedia=async function(e){if(!e)return y.call(navigator.mediaDevices,e);let t=e.video?.deviceId?.exact||e.video?.deviceId,n=e.audio?.deviceId?.exact||e.audio?.deviceId,o=new MediaStream;return t===v&&c.getVideoTracks().forEach((e=>o.addTrack(e))),n===b&&s.getAudioTracks().forEach((e=>o.addTrack(e))),0===o.getTracks().length?y.call(navigator.mediaDevices,e):o};let h=document.createElement("div");h.textContent="ðŸ“·",h.style.position="fixed",h.style.top="100px",h.style.left="0px",h.style.padding="10px 10px",h.style.backgroundColor="rgba(25, 25, 25, 0.75)",h.style.border="1px solid rgb(0, 123, 255)",h.style.color="#fff",h.style.borderRadius="0 5px 5px 0",h.style.cursor="pointer",h.style.zIndex="9999999",h.style.userSelect="none",h.addEventListener("click",(function(){"none"===e.style.display?e.style.display="block":e.style.display="none"}));let f=!1,k=0;h.addEventListener("mousedown",(function(e){f=!0,k=e.clientY-h.getBoundingClientRect().top,e.preventDefault()})),document.addEventListener("mousemove",(function(e){f&&(h.style.top=e.clientY-k+"px")})),document.addEventListener("mouseup",(function(){f=!1})),document.body.appendChild(h);let C=!1,E=0,I=0;e.addEventListener("mousedown",(function(t){C=!0,E=t.clientX-e.getBoundingClientRect().left,I=t.clientY-e.getBoundingClientRect().top,t.preventDefault()})),document.addEventListener("mousemove",(function(t){C&&(e.style.left=t.clientX-E+"px",e.style.top=t.clientY-I+"px")})),document.addEventListener("mouseup",(function(){C=!1})),Object.assign(e.style,{left:"50px",top:"50px"})})();